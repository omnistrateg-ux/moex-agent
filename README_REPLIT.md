# MOEX Agent ‚Äî AI-Powered Trading Signal Generator

## üéØ –ß—Ç–æ —ç—Ç–æ?

**MOEX Agent** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏ —Å –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–æ–º —É—Ä–æ–≤–Ω—è –ø—Ä–æ–ø-—Ç—Ä–µ–π–¥–∏–Ω–≥ –¥–µ—Å–∫–∞.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ü§ñ **ML-–º–æ–¥–µ–ª–∏** –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã (4 –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞: 5m, 10m, 30m, 1h)
- üìä **Walk-Forward –≤–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî —á–µ—Å—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –±–µ–∑ data leakage
- ‚ö° **Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** 46 –∞–∫—Ü–∏–π MOEX
- üõ°Ô∏è **Risk Engine** ‚Äî Kill-Switch, Dynamic Leverage, Regime Detection, Tier System
- üì± **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ —Å–∏–≥–Ω–∞–ª–∞—Ö –∏ —Å–¥–µ–ª–∫–∞—Ö
- üåê **Web Dashboard** —Å Equity Curve –∏ Day Mode –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- üß† **Multi-LLM Orchestrator** ‚Äî –∫–æ–Ω—Å–µ–Ω—Å—É—Å 5 AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤
- üéØ **CONTINUATION_MODE** ‚Äî –∑–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 5% —Ü–µ–ª–∏

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–¥–µ–ª–µ–π (Walk-Forward)

| –ì–æ—Ä–∏–∑–æ–Ω—Ç | Win Rate | Profit Factor | Sharpe |
|----------|----------|---------------|--------|
| 5m       | 56.8%    | 2.33          | 3.44   |
| 10m      | 56.0%    | 2.31          | 3.74   |
| 30m      | 56.0%    | 2.39          | 4.33   |
| 1h       | 55.4%    | 2.39          | 4.90   |

**–î–∞–Ω–Ω—ã–µ:** 32.6M —Å–≤–µ—á–µ–π, 4+ –≥–æ–¥–∞ –∏—Å—Ç–æ—Ä–∏–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      MOEX Agent                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ  MOEX    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Feature  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ    ML    ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ  ISS API ‚îÇ    ‚îÇ Engine   ‚îÇ    ‚îÇ  Models  ‚îÇ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ       ‚îÇ               ‚îÇ               ‚îÇ                     ‚îÇ
‚îÇ       ‚ñº               ‚ñº               ‚ñº                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ SQLite   ‚îÇ    ‚îÇ  29+     ‚îÇ    ‚îÇ Predict  ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ Storage  ‚îÇ    ‚îÇ Features ‚îÇ    ‚îÇ Signals  ‚îÇ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ                                       ‚îÇ                     ‚îÇ
‚îÇ                                       ‚ñº                     ‚îÇ
‚îÇ                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ                              ‚îÇ  Risk Engine ‚îÇ               ‚îÇ
‚îÇ                              ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ               ‚îÇ
‚îÇ                              ‚îÇ ‚Ä¢ Kill-Switch‚îÇ               ‚îÇ
‚îÇ                              ‚îÇ ‚Ä¢ Leverage   ‚îÇ               ‚îÇ
‚îÇ                              ‚îÇ ‚Ä¢ Regime     ‚îÇ               ‚îÇ
‚îÇ                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                                       ‚îÇ                     ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ                    ‚ñº                  ‚ñº                  ‚ñº  ‚îÇ
‚îÇ             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ             ‚îÇ Telegram ‚îÇ      ‚îÇ  Paper   ‚îÇ      ‚îÇ  Web   ‚îÇ ‚îÇ
‚îÇ             ‚îÇ   Bot    ‚îÇ      ‚îÇ Trading  ‚îÇ      ‚îÇ   UI   ‚îÇ ‚îÇ
‚îÇ             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
moex_agent/
‚îú‚îÄ‚îÄ moex_agent/                 # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ __main__.py             # Entry point
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === DATA LAYER ===
‚îÇ   ‚îú‚îÄ‚îÄ moex_iss.py             # API –∫–ª–∏–µ–Ω—Ç MOEX ISS
‚îÇ   ‚îú‚îÄ‚îÄ storage.py              # SQLite —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îú‚îÄ‚îÄ bootstrap.py            # –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === FEATURE ENGINEERING ===
‚îÇ   ‚îú‚îÄ‚îÄ features.py             # 29 —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ labels.py               # –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–∫ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === ML MODELS ===
‚îÇ   ‚îú‚îÄ‚îÄ predictor.py            # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ inference –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ train.py                # –ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ advanced_train.py       # Walk-Forward –æ–±—É—á–µ–Ω–∏–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === SIGNAL GENERATION ===
‚îÇ   ‚îú‚îÄ‚îÄ anomaly.py              # –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π (—Å–∏–≥–Ω–∞–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ engine.py               # –û—Å–Ω–æ–≤–Ω–æ–π pipeline
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === RISK MANAGEMENT ===
‚îÇ   ‚îú‚îÄ‚îÄ margin_risk_engine.py   # Kill-Switch, Leverage, Regime, Tiers
‚îÇ   ‚îú‚îÄ‚îÄ orchestrator.py         # Multi-LLM Consensus Engine
‚îÇ   ‚îú‚îÄ‚îÄ bcs_broker.py           # –õ–∏–º–∏—Ç—ã –±—Ä–æ–∫–µ—Ä–∞ –ë–ö–°
‚îÇ   ‚îú‚îÄ‚îÄ risk.py                 # –ë–∞–∑–æ–≤—ã–µ —Ä–∏—Å–∫-–ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === TRADING ===
‚îÇ   ‚îú‚îÄ‚îÄ paper_trading.py        # Paper trading (–±–∞–∑–æ–≤—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ margin_paper_trading.py # Margin paper trading
‚îÇ   ‚îú‚îÄ‚îÄ live.py                 # Live —Ä–µ–∂–∏–º
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === INTERFACE ===
‚îÇ   ‚îú‚îÄ‚îÄ telegram.py             # Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ webapp.py               # FastAPI web server
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.py            # Web dashboard
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ‚îÄ‚îÄ # === CONFIG ===
‚îÇ   ‚îú‚îÄ‚îÄ config.py               # Legacy config
‚îÇ   ‚îú‚îÄ‚îÄ config_schema.py        # Pydantic config schema
‚îÇ   ‚îî‚îÄ‚îÄ logging_config.py       # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ models/                     # –û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ model_time_5m.joblib
‚îÇ   ‚îú‚îÄ‚îÄ model_time_10m.joblib
‚îÇ   ‚îú‚îÄ‚îÄ model_time_30m.joblib
‚îÇ   ‚îî‚îÄ‚îÄ model_time_1h.joblib
‚îÇ
‚îú‚îÄ‚îÄ data/                       # –î–∞–Ω–Ω—ã–µ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ moex_agent.sqlite       # –ë–∞–∑–∞ —Å–≤–µ—á–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ margin_paper_state.json # –°–æ—Å—Ç–æ—è–Ω–∏–µ paper trading
‚îÇ
‚îú‚îÄ‚îÄ config.yaml                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ pyproject.toml              # Python package config
```

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### 1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
```
MOEX ISS API ‚Üí 1-–º–∏–Ω—É—Ç–Ω—ã–µ —Å–≤–µ—á–∏ ‚Üí SQLite
```
- –ó–∞–≥—Ä—É–∂–∞–µ–º OHLCV –¥–∞–Ω–Ω—ã–µ –¥–ª—è 46 —Ç–∏–∫–µ—Ä–æ–≤
- –•—Ä–∞–Ω–∏–º –≤ SQLite –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### 2. Feature Engineering (29 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)
```python
# Trend
- SMA 20, 50
- EMA 12, 26
- MACD, Signal, Histogram

# Momentum
- RSI 14
- Stochastic %K, %D
- ROC 10, 20
- Williams %R

# Volatility
- ATR 14
- Bollinger Bands (width, %B)
- Keltner Channels

# Volume
- OBV, OBV change
- VWAP
- Volume SMA ratio

# Price Action
- Candle body ratio
- Upper/Lower shadows
- Gap detection
```

### 3. ML Prediction
```
Features ‚Üí HistGradientBoosting ‚Üí Probability[0-1]
```
- 4 –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–≤
- –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π (Isotonic)
- Threshold: 54% –¥–ª—è –≤—Ö–æ–¥–∞

### 4. Risk Assessment
```python
def assess_trade(signal):
    # 1. Regime Detection (BULL/BEAR/SIDEWAYS/HIGH_VOL)
    regime = detect_regime(candles)

    # 2. Kill-Switch Check
    if daily_loss >= 2% or weekly_loss >= 5%:
        return DISABLE

    # 3. Dynamic Leverage
    leverage = f(confidence, regime, volatility, drawdown)

    # 4. Position Sizing
    size = max_risk / (atr * leverage)

    return ALLOW if leverage > 0 else DISABLE
```

### 5. Execution (Paper Trading)
```
Signal + Risk OK ‚Üí Open Position ‚Üí Monitor ‚Üí Close (Take/Stop/Timeout)
```

---

## üõ°Ô∏è Risk Management Rules

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –õ–∏–º–∏—Ç |
|----------|-------|
| Daily target | **5%** |
| Max loss per trade | 0.5% equity |
| Max daily loss | 2% |
| Max weekly loss | 5% |
| Max drawdown | 10% |
| Kill after losses | **2 –ø–æ–¥—Ä—è–¥** ‚Üí HALT_DAY |
| Disabled horizons | 1d, 1w (gap risk) |

### Tier System (Trade Classification)

| Tier | Min R | Min PnL% | Risk% | –î–µ–π—Å—Ç–≤–∏–µ |
|------|-------|----------|-------|----------|
| **A+** | ‚â•2.3 | ‚â•1.5% | 1.5% | –õ—É—á—à–∏–µ —Å–¥–µ–ª–∫–∏ |
| **A** | ‚â•2.0 | ‚â•1.0% | 1.2% | –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ |
| **B** | ‚â•1.6 | ‚â•0.6% | 0.8% | –î–æ–ø—É—Å—Ç–∏–º—ã–µ |
| **C** | <1.6 | - | 0% | **NO TRADE** |

### Cost Gate
```
(spread + fees + slippage) ‚â§ 20% of expected_gain
```

### CONTINUATION_MODE (–ø–æ—Å–ª–µ 5% —Ü–µ–ª–∏)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| risk_multiplier | 0.5-0.7 |
| max_additional_trades | 2 |
| min_expected_R | 2.0 |
| profit_protection | 80% –æ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏ |

### Dynamic Leverage Formula
```
base_lev = HORIZON_MAX[horizon]  # 5m=3x, 10m=3x, 30m=2.5x, 1h=2x

multipliers:
  confidence: (prob - 0.54) / 0.1  # 0.54-0.64 ‚Üí 0-1
  regime: BULL=1.0, SIDEWAYS=0.7, HIGH_VOL=0.3, BEAR=0.0
  volatility: 1.0 - vol_percentile * 0.5
  drawdown: 1.0 - (dd_pct / 10) * 0.5
  loss_streak: 1.0 - streak * 0.15

final_leverage = base_lev * product(multipliers)
```

---

## üß† Multi-LLM Orchestrator

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 5 LLM-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ –¥–ª—è –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞:

| # | –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –†–æ–ª—å | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç |
|---|-----------|------|-----------|
| 1 | **OpenAI** (GPT-4o) | Structure & Logic | R-—Ä–∞—Å—á—ë—Ç—ã, cost gate, risk limits |
| 2 | **Qwen** | Alternative Hypotheses | –î—Ä—É–≥–∏–µ —Ç–∏–∫–µ—Ä—ã, —Å–µ—Ç–∞–ø—ã, —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã |
| 3 | **Grok** | Failure Modes | Red flags, worst-case —Å—Ü–µ–Ω–∞—Ä–∏–∏ |
| 4 | **YandexGPT** | News Interpreter | STUB (–¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏) |
| 5 | **Perplexity** | News & Fact Check | –ù–æ–≤–æ—Å—Ç–∏ 24-48—á, —Å–æ–±—ã—Ç–∏—è, —Ñ–∞–∫—Ç-—á–µ–∫ |

### –ü—Ä–∞–≤–∏–ª–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞:
- **TRADE**: ‚â•3 SUPPORT + 0 REJECT
- **NO_TRADE**: ‚â•2 REJECT –∏–ª–∏ <3 SUPPORT
- **HALT_DAY**: –°—Ä–∞–±–æ—Ç–∞–ª kill-switch

### –ü—Ä–æ–º–ø—Ç—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤:
- `OPENAI_ANALYST_PROMPT.md`
- `QWEN_ANALYST_PROMPT.md`
- `GROK_ANALYST_PROMPT.md`
- `PERPLEXITY_ANALYST_PROMPT.md`

---

## üöÄ –ó–∞–ø—É—Å–∫

### Paper Trading (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º)
```bash
python -m moex_agent.margin_paper_trading
```

### Web Dashboard
```bash
python -m moex_agent.webapp
# ‚Üí http://localhost:8080
```

### Bootstrap –¥–∞–Ω–Ω—ã—Ö
```bash
python -m moex_agent.bootstrap --days 14
```

### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
```bash
python -m moex_agent.advanced_train --horizons 5m 10m 30m 1h
```

---

## üåê Web API Endpoints

| Endpoint | Method | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| `/` | GET | Dashboard HTML |
| `/api/status` | GET | –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã |
| `/api/signals` | GET | –¢–µ–∫—É—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã |
| `/api/positions` | GET | –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ |
| `/api/trades` | GET | –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ |
| `/api/equity` | GET | Equity curve |
| `/health` | GET | Health check |

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.yaml)

```yaml
app:
  poll_seconds: 5          # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞
  cooldown_minutes: 30     # –ö—É–ª–¥–∞—É–Ω –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–∞–º–∏

storage:
  sqlite_path: "data/moex_agent.sqlite"

universe:
  tickers:
    - SBER
    - GAZP
    - LKOH
    # ... 46 —Ç–∏–∫–µ—Ä–æ–≤

signals:
  horizons:
    - { name: "5m",  minutes: 5 }
    - { name: "10m", minutes: 10 }
    - { name: "30m", minutes: 30 }
    - { name: "1h",  minutes: 60 }
  p_threshold: 0.52
  price_exit:
    take_atr: 0.70
    stop_atr: 0.40

telegram:
  enabled: true
  # Set via environment: TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID
```

---

## üîë Environment Variables

| Variable | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ |
| `TELEGRAM_CHAT_ID` | ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

---

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

### Telegram —Å–∏–≥–Ω–∞–ª:
```
üé∞ MARGIN PAPER TRADING

üìà –ù–û–í–ê–Ø –ü–û–ó–ò–¶–ò–Ø
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìç SBER | LONG
üìä –ü–ª–µ—á–æ: 2.1x | –†–µ–∂–∏–º: BULL
üíµ –¶–µ–Ω–∞: 267.50 ‚ÇΩ
üì¶ –†–∞–∑–º–µ—Ä: 150 —à—Ç. (85,000 ‚ÇΩ)
üéØ Take: 269.80 | Stop: 266.10
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üíµ EQUITY: 200,000 ‚ÇΩ
```

### –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏:
```
üé∞ MARGIN PAPER TRADING

‚úÖ –°–î–ï–õ–ö–ê –ó–ê–ö–†–´–¢–ê
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìç SBER (LONG)
üìä –ü–ª–µ—á–æ: 2.1x
üí∞ –ü–†–ò–ë–´–õ–¨: +1,450 ‚ÇΩ (+1.71%)
üìä –ü—Ä–∏—á–∏–Ω–∞: take
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üíµ EQUITY: 201,450 ‚ÇΩ
üìâ Drawdown: 0.0%
üî¢ Loss Streak: 0
```

---

## üéì –î–ª—è Replit AI

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –≠—Ç–æ production-ready —Ç–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è MOEX. –ú–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω—ã –Ω–∞ 32M —Å–≤–µ—á–µ–π —Å Walk-Forward –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

**–ì–ª–∞–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `margin_paper_trading.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π trading loop
- `margin_risk_engine.py` ‚Äî —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç —Å Tier —Å–∏—Å—Ç–µ–º–æ–π
- `orchestrator.py` ‚Äî Multi-LLM –∫–æ–Ω—Å–µ–Ω—Å—É—Å (5 –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤)
- `webapp.py` ‚Äî web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å Equity Curve
- `features.py` ‚Äî feature engineering
- `predictor.py` ‚Äî ML inference

**–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤:**
- `REPLIT_ORCHESTRATOR_PROMPT.md` ‚Äî –≥–ª–∞–≤–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- `OPENAI_ANALYST_PROMPT.md` ‚Äî GPT-4o (Structure & Logic)
- `QWEN_ANALYST_PROMPT.md` ‚Äî Qwen (Alternative Hypotheses)
- `GROK_ANALYST_PROMPT.md` ‚Äî Grok (Failure Modes)
- `PERPLEXITY_ANALYST_PROMPT.md` ‚Äî Perplexity (News & Fact Check)

**–î–ª—è –≤–µ–±-–ø—Ä–æ–¥—É–∫—Ç–∞:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `webapp.py` –Ω–∞ –ø–æ—Ä—Ç—É 8080
2. Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: equity curve, day mode, –ø–æ–∑–∏—Ü–∏–∏, —Å–∏–≥–Ω–∞–ª—ã, –∏—Å—Ç–æ—Ä–∏—é
3. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- Daily target: **5%**
- Max consecutive losses: **2** (–∑–∞—Ç–µ–º HALT_DAY)
- Tier A+: R ‚â• 2.3, PnL ‚â• 1.5%
- Cost gate: costs ‚â§ 20% of expected gain
- CONTINUATION_MODE: –ø–æ—Å–ª–µ 5% ‚Äî max 2 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–¥–µ–ª–∫–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Replit:**
- –ù–µ—Ç GPU (–Ω–æ –º–æ–¥–µ–ª–∏ CPU-only)
- Storage ~1GB (–±–∞–∑–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–∞ –ª–µ—Ç—É)
- –î–ª—è 24/7 –Ω—É–∂–µ–Ω Always On (–ø–ª–∞—Ç–Ω—ã–π)
